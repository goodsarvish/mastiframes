<!doctype html>
<html lang="hi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>MastiFrames — Single File Demo</title>
<style>
  :root{--accent:#1f7a8c;--accent2:#2a9d8f;--bg:#f4f7fb}
  body{margin:0;font-family:Arial,Helvetica,sans-serif;background:var(--bg);color:#222}
  header{background:linear-gradient(90deg,var(--accent),var(--accent2));color:#fff;padding:14px 16px;display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;font-size:20px}
  .container{max-width:1100px;margin:16px auto;padding:12px}
  .controls{display:flex;gap:12px;align-items:center}
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px}
  .card{background:#fff;padding:8px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.06);position:relative;overflow:hidden}
  .card img{width:100%;height:130px;object-fit:cover;border-radius:8px}
  .card .title{margin-top:8px;font-weight:700}
  .btn{background:var(--accent);color:#fff;padding:8px 10px;border-radius:8px;border:none;cursor:pointer}
  .small{background:#eee;padding:6px 8px;border-radius:8px;color:#333;font-size:13px;cursor:pointer}
  .badge{position:absolute;left:8px;top:8px;background:rgba(0,0,0,0.55);color:#fff;padding:4px 6px;border-radius:6px;font-size:12px}
  .booked{position:absolute;right:8px;top:8px;background:#ffd166;color:#222;padding:4px 6px;border-radius:6px;font-weight:800}
  footer{margin-top:18px;color:#666;text-align:center;padding:12px}
  /* modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,0.5);display:none;align-items:center;justify-content:center;padding:12px;z-index:60}
  .modal.show{display:flex}
  .modal-card{background:#fff;border-radius:10px;padding:16px;max-width:520px;width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.2);position:relative}
  .close{position:absolute;right:10px;top:8px;border:none;background:none;font-size:18px;cursor:pointer}
  .flex{display:flex;gap:12px;align-items:center}
  .qr{width:140px;height:140px;border-radius:10px;background:#f1f3f5;display:flex;align-items:center;justify-content:center}
  .field{display:flex;align-items:center;gap:8px;margin:6px 0}
  .field strong{min-width:90px}
  .edit-icon{cursor:pointer;padding:6px;border-radius:6px;background:#f0f0f0}
  .note{width:100%;padding:8px;border-radius:8px;border:1px solid #ddd;min-height:56px}
  .pencil{display:inline-block;margin-left:6px;cursor:pointer;color:#1f7a8c}
  .owner-panel{margin-top:10px;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
  input[type=file]{display:inline-block}
  /* responsive */
  @media (max-width:640px){ .flex{flex-direction:column;align-items:stretch} .qr{width:120px;height:120px} }
</style>
</head>
<body>
  <header>
    <h1>MastiFrames — Demo</h1>
    <div class="controls">
      <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="ownerToggle"> Owner Mode</label>
      <button id="resetBtn" class="small">Reset Demo</button>
    </div>
  </header>

  <main class="container">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
      <div><strong>Products (Frames)</strong><div style="color:#666;font-size:13px">Click frame → Buy / Book ₹300</div></div>
      <div style="color:#666;font-size:13px">Images & orders localStorage me saved</div>
    </div>

    <div id="grid" class="grid"></div>

    <footer>
      © <span id="yr"></span> MastiFrames — Demo. Payment simulated.
    </footer>
  </main>

  <!-- payment / scanner modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true">
      <button class="close" id="closeModal">✕</button>
      <div class="flex">
        <div class="qr" id="qrBox">
          <!-- placeholder QR image -->
          <img id="qrImg" src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=MastiFrames" alt="QR" style="width:100%;height:100%;object-fit:contain;border-radius:8px">
        </div>
        <div style="flex:1">
          <h3 id="modalTitle">Product</h3>
          <div class="field"><strong>Advance:</strong> <span id="advanceVal">₹300</span>
            <span class="pencil" title="Edit advance" id="editAdvance">✎</span>
          </div>
          <div class="field"><strong>Total:</strong> <span id="totalVal">₹600</span>
            <span class="pencil" title="Edit total" id="editTotal">✎</span>
          </div>
          <div class="field"><strong>Remaining:</strong> <span id="remainVal">₹300</span></div>

          <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="payBtn" class="btn">Pay ₹300 (Advance)</button>
            <button id="markDelivered" class="small" style="display:none">Mark Delivered</button>
            <button id="viewOrder" class="small" style="display:none">View Order</button>
          </div>
          <div style="margin-top:10px">
            <label style="font-weight:700">Note / Message <span class="pencil" id="editNote">✎</span></label>
            <textarea id="noteBox" class="note" placeholder="Yahan likho..."></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
/* Single-file MastiFrames demo
   - 15 frames
   - owner can change images (local)
   - click Buy → opens modal (qr + details)
   - advance default ₹300, total editable, remaining auto
   - pay simulated (marks booked)
   - orders stored in localStorage
*/

const TOTAL = 15;
const grid = document.getElementById('grid');
const ownerToggle = document.getElementById('ownerToggle');
const resetBtn = document.getElementById('resetBtn');
const yr = document.getElementById('yr'); yr.textContent = new Date().getFullYear();

// modal elements
const modal = document.getElementById('modal');
const closeModal = document.getElementById('closeModal');
const modalTitle = document.getElementById('modalTitle');
const advanceVal = document.getElementById('advanceVal');
const totalVal = document.getElementById('totalVal');
const remainVal = document.getElementById('remainVal');
const payBtn = document.getElementById('payBtn');
const markDelivered = document.getElementById('markDelivered');
const viewOrder = document.getElementById('viewOrder');
const qrImg = document.getElementById('qrImg');
const noteBox = document.getElementById('noteBox');
const editTotal = document.getElementById('editTotal');
const editAdvance = document.getElementById('editAdvance');
const editNote = document.getElementById('editNote');

let products = [];
let orders = []; // {orderId, productId, advance, total, note, status}

function loadState(){
  const p = localStorage.getItem('mf_products_v2');
  const o = localStorage.getItem('mf_orders_v2');
  products = p ? JSON.parse(p) : [];
  orders = o ? JSON.parse(o) : [];
  if(products.length === 0){
    for(let i=1;i<=TOTAL;i++){
      products.push({id:i,title:`Product ${i}`, image:`https://via.placeholder.com/400x300.png?text=Frame+${i}`, booked:false});
    }
    saveProducts();
  }
}
function saveProducts(){ localStorage.setItem('mf_products_v2', JSON.stringify(products)); }
function saveOrders(){ localStorage.setItem('mf_orders_v2', JSON.stringify(orders)); }

function renderGrid(){
  grid.innerHTML = '';
  products.forEach(p=>{
    const card = document.createElement('div'); card.className='card';
    const img = document.createElement('img'); img.src = p.image; img.alt = p.title;
    card.appendChild(img);
    const badge = document.createElement('div'); badge.className='badge'; badge.innerText = '#'+p.id;
    card.appendChild(badge);
    if(p.booked) { const b = document.createElement('div'); b.className='booked'; b.innerText='BOOKED'; card.appendChild(b); }
    const title = document.createElement('div'); title.className='title'; title.innerText = p.title; card.appendChild(title);
    const btns = document.createElement('div'); btns.style.marginTop='8px';
    const buy = document.createElement('button'); buy.className='btn'; buy.innerText='Buy / Book ₹300';
    buy.onclick = ()=> openPayment(p.id);
    btns.appendChild(buy);
    card.appendChild(btns);

    // owner controls
    if(ownerToggle.checked){
      const ownerDiv = document.createElement('div'); ownerDiv.className='owner-panel';
      const file = document.createElement('input'); file.type='file'; file.accept='image/*';
      file.onchange = ()=> {
        const f = file.files[0]; if(!f) return;
        const reader = new FileReader();
        reader.onload = (ev)=> {
          p.image = ev.target.result; saveProducts(); renderGrid();
        };
        reader.readAsDataURL(f);
      };
      const editTitle = document.createElement('input'); editTitle.type='text'; editTitle.value=p.title;
      editTitle.style.padding='6px'; editTitle.style.borderRadius='8px'; editTitle.style.border='1px solid #ddd';
      editTitle.onchange = ()=> { p.title = editTitle.value; saveProducts(); renderGrid(); };
      ownerDiv.appendChild(file);
      ownerDiv.appendChild(editTitle);
      card.appendChild(ownerDiv);
    }

    grid.appendChild(card);
  });
}

// find order for product
function findOrderByProduct(pid){
  return orders.find(o=>o.productId===pid && (o.status==='paid' || o.status==='pending' || o.status==='delivered'));
}

let currentProduct = null;
let currentOrder = null;

function openPayment(productId){
  currentProduct = products.find(x=>x.id===productId);
  const existing = findOrderByProduct(productId);
  // default values
  let adv = 300;
  let tot = 600;
  let note = '';
  if(existing){
    adv = existing.advance; tot = existing.total; note = existing.note || '';
    currentOrder = existing;
  } else {
    currentOrder = null;
  }
  modalTitle.innerText = currentProduct.title;
  advanceVal.innerText = '₹' + adv;
  totalVal.innerText = '₹' + tot;
  remainVal.innerText = '₹' + Math.max(0, tot - adv);
  noteBox.value = note;
  // QR: include order id in QR if exists else product id
  qrImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=${encodeURIComponent('product:'+productId)}`;
  // show/hide buttons based on order status
  if(currentOrder && currentOrder.status === 'paid'){
    payBtn.style.display = 'none';
    markDelivered.style.display = 'inline-block';
    viewOrder.style.display = 'inline-block';
  } else {
    payBtn.style.display = 'inline-block';
    markDelivered.style.display = 'none';
    viewOrder.style.display = 'none';
  }
  modal.classList.add('show');
  modal.setAttribute('aria-hidden','false');
}

// edit handlers
editTotal.addEventListener('click', ()=>{
  const cur = parseInt(totalVal.innerText.replace('₹','')) || 0;
  const v = prompt('Total amount set karo (rupees)', cur);
  if(v!==null){
    const n = parseInt(v);
    if(!isNaN(n)){ totalVal.innerText = '₹'+n; updateRemaining(); }
  }
});
editAdvance.addEventListener('click', ()=>{
  const cur = parseInt(advanceVal.innerText.replace('₹','')) || 0;
  const v = prompt('Advance amount set karo (rupees)', cur);
  if(v!==null){
    const n = parseInt(v);
    if(!isNaN(n)){ advanceVal.innerText = '₹'+n; updateRemaining(); }
  }
});
editNote.addEventListener('click', ()=> {
  noteBox.focus();
});

// compute remaining
function updateRemaining(){
  const a = parseInt(advanceVal.innerText.replace('₹','')) || 0;
  const t = parseInt(totalVal.innerText.replace('₹','')) || 0;
  const rem = Math.max(0, t - a);
  remainVal.innerText = '₹' + rem;
}

// pay simulation
payBtn.addEventListener('click', ()=>{
  const adv = parseInt(advanceVal.innerText.replace('₹','')) || 0;
  const tot = parseInt(totalVal.innerText.replace('₹','')) || 0;
  const note = noteBox.value || '';
  const confirmPay = confirm(`Aap ₹${adv} advance pay karna chahte hain? (Simulated)`);
  if(!confirmPay) return;
  // create or update order
  let order;
  if(currentOrder){
    order = currentOrder;
    order.advance = adv; order.total = tot; order.note = note; order.status = 'paid';
  } else {
    order = { orderId: 'ord'+Date.now(), productId: currentProduct.id, advance: adv, total: tot, note: note, status:'paid', createdAt:new Date().toISOString() };
    orders.push(order);
  }
  // mark product booked
  const prod = products.find(x=>x.id===currentProduct.id);
  if(prod){ prod.booked = true; saveProducts(); }
  saveOrders();
  alert('Payment successful (simulated). Advance recorded: ₹' + adv);
  renderGrid();
  modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
});

// mark delivered
markDelivered.addEventListener('click', ()=>{
  if(!currentOrder){ alert('Order nahi mila'); return; }
  currentOrder.status = 'delivered';
  saveOrders();
  alert('Order marked delivered. Aap final payment collect kar sakte hain.');
  modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
  renderGrid();
});

// view order
viewOrder.addEventListener('click', ()=>{
  if(!currentOrder){ alert('No order'); return; }
  alert('Order: ' + JSON.stringify(currentOrder, null, 2));
});

// modal close
closeModal.addEventListener('click', ()=>{
  modal.classList.remove('show'); modal.setAttribute('aria-hidden','true');
});

// reset demo
resetBtn.addEventListener('click', ()=>{
  if(!confirm('Sare demo data reset karna hai? (images & orders reset honge)')) return;
  localStorage.removeItem('mf_products_v2'); localStorage.removeItem('mf_orders_v2');
  loadState(); renderGrid();
  alert('Reset ho gaya.');
});

// owner toggle re-render
ownerToggle.addEventListener('change', renderGrid);

// initial load
loadState();
renderGrid();

</script>
</body>
</html>
